<!doctype html>
<html>
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="content-type" />
<meta name="viewport" content="width=device-width,initial-scale=1">
		<!--<script type="text/javascript" src="../src/jmchart.debug.js" id="jmgraph" ></script>-->

		<style>
		html,body {
			margin:0;
			padding:0;
			width:100%;
			height:100%;
		}
		#mycanvas canvas, #mycanvas div{
			background-color:#fff;
			margin:0 auto;		
		}
		/*div.jm-tooltip {
			background-color: rgba(255,255,255,0.8);
			padding:4px;
			border:1px solid #000;
			box-shadow: 0 0 3px #000;
			border-radius: 6px;
		}*/
		</style>
		<script type="module">
			
			import { jmChart } from '../dist/jmchart.esm.js';

			(function load() {
				var w = Math.max((window.innerWidth || window.document.body.clientWidth) * 0.8, 300);
				var h = Math.max((window.innerHeight || window.document.body.clientHeight) * 0.4, 200);			
				inichart(w,h);
			})();
			

			function inichart(w, h) {
					var chart1 = new jmChart('mycanvas1', {
						width: w,
						height: h,
						enableAnimate: false,
						autoRefresh: true,
                        style: {
							markLine: false // 不展示标线
                        }
                    });
					
					var pie1 = chart1.createSeries('pie', {
						field: 'y1',
						anticlockwise: false, //是否逆时针
						legendFormat: function(options) {
							return 'test' + options.data.x;
						},
						labelFormat: function(point) {
							return (point.step * 100).toFixed(2) + '%';
						},
						style: {
							isHollow: true, // 是否空心
							arcWidth: 80, // 圆弧宽
							label: {
								show: true, // 默认就是true
								stroke: 'red',
								fill: '#ccc',
								textAlign: 'center',
								textBaseline: 'middle',
								border: {
									top: true,
									left: true,
									right: true,
									bottom: true,
									style: {
										fill: '#000'
									}
								}
							}
						}
					});
					
					var chart2 = new jmChart('mycanvas2', {
						width: w,
						height: h,
						enableAnimate: true,
						autoRefresh: true,// 启用动画，建议指定自动动画，否则需要自已写刷新代码
                        style: {
							markLine: false, // 不展示标线
							// 指定一个渐变的样式，这里也可以不指定，会用默认的
                            chartColors: [
								`radial-gradient(50% 50% 0 50% 50% 100%, 
												#42a4ff 0, 
												#62A2E0 0.5,
												#0D64B7 1)`,
								`radial-gradient(50% 50% 0 50% 50% 100%, 
												#fa7d7d 0, 
												#F2ADB2 0.5,
												#fa7d7d 1)`,
								`radial-gradient(50% 50% 0 50% 50% 100%, 
												#007aff 0, 
												#6CA7E8 0.5,
												#054893 1)`
							]
                        }
                    });
					
					var pie2 = chart2.createSeries('pie', {
						field: 'y1',
						anticlockwise: true, //是否逆时针
						legendFormat: function(options) {
							return 'test' + options.data.x;
						},
						style: {
							isHollow: false, // 是否空心
							arcWidth: 50 // 空心时，圆弧的宽度, 不指定就默认20%半径
						}
                    });
                    
                    const datacount = 4;
					function refreshData() {
						
							const data = [];
							/*for(var i = 0;i<datacount;i++) {
								const row = {
									x : i,
									y1 :  Math.random() * 200 - 100
								};
								if(i == 3) {
									row.y = null;
								}
								data.push(row);
							}*/

							data.push({
									x : 0,
									y1 :  50
								});

							data.push({
								x : 1,
								y1 :  50 / (datacount - 1)
							});

							data.push({
								x : 2,
								y1 :  50 / (datacount - 1)
							});

							data.push({
								x : 3,
								y1 :  50 / (datacount - 1)
							});
						
						chart2.data = chart1.data = data;
						//setTimeout(animate,500);
						chart1.refresh(); // 默认刷新一次
						chart2.refresh();

						console.log(chart1.data);
					}

					
					refreshData();

					chart1.utils.bindEvent(document.getElementById('btnRedraw'),'click', refreshData);
					
					// // 自动刷新代码
					// function update() {
					// 	if(chart1.needUpdate) chart1.redraw();
					// 	requestAnimationFrame(update);
					// }
					// requestAnimationFrame(update);
				}
		</script>
	</head>
	<body>
		<div id="mycanvas1">
			</div>
		<div id="mycanvas2">
			</div>	
			<button id="btnRedraw">重绘</button>		
	</body>
</html>
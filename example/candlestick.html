<!doctype html>
<html>
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="content-type" />
<meta name="viewport" content="width=device-width,initial-scale=1">
		<!--<script type="text/javascript" src="../src/jmchart.debug.js" id="jmgraph" ></script>-->

		<style>
		html,body {
			margin:0;
			padding:0;
			width:100%;
			height:100%;
		}
		</style>
		<script type="module">
			import jmChart from '../dist/jmchart.esm.js';
			(function load() {
				var w = Math.max((window.innerWidth || window.document.body.clientWidth) * 0.8, 500);
				var h = Math.min((window.innerHeight || window.document.body.clientHeight) * 0.5, 500);			
				inichart(w,h);
			})();
			

			function inichart(w, h) {

                    

					const chart = new jmChart('mycanvas', {
						width: w,
						height: h,
                        xField: 'x',
                        enableAnimate: false,
                        legendPosition: 'top',
                        legendVisible: false, // 不显示图例
						// 最大和最小X值，  这里一般不用指定，除非硬是需要
						minXValue : 0,
						maxXValue : 10,
                        //touchGraph: true, // 是否依赖生成操作图层，当点比较多时，性能低下可以把它设为true
						autoRefresh: true,
						//minYValue: -100,
						//maxYValue: 15,
                        // 格式化x标签值
                        xLabelFormat: (v, item, index) => {
                            // 只展示第一个和最后一个
                            if(index % 5 === 0) {
                                return v;
                            }  
                            return '';
                        },
                        style: {
                            layout: 'inside',	// inside 二边不对齐Y轴，内缩一个刻度 | normal
							// 跟随标线
							markLine: {
								x: false, // 显示X标线
								y: true, // 显示Y标线
								stroke: 'red',
								fill: '#fff',
								lineWidth: 1,
							},
                            // x轴 Y轴隐藏
                            axis: {
								stroke: 'transparent',
								align: 'center', // label居中对齐
                                grid: {
                                    x: false,  // 不显示X轴网格
                                    y: false     // 显示Y轴网格
                                }
                            },
                            // 隐藏边框
                            chartArea: {
                                //stroke: 'transparent'
                            },
                            margin: {
                                top: 30,
                                left: 50,
                                right: 10,
                                bottom: 30
                            }
                        }
					});	
                    // touch改变数据点事件
					chart.on('touchPointChange', function(args) {
						console.log(args);
                        document.getElementById('mylog').innerHTML = JSON.stringify(args.points[0].data);
					});			

					const line = chart.createSeries('candlestick', {
                        // 如果字段名跟下面的一至，可以不指定
						fields: [
							'start',  // 开盘
                            'end',      // 收盘
                            'max',     // 最大值
                            'min'      // 最小值
						],
                        style: {
                            // 阴线颜色
                            negativeColor: 'green',
                            // 阳线颜色
                            masculineColor: 'red',
                            //barWidth: 15
                        }
					});
					
					var datacount = 21;
					function refresh() {
                        chart.data = [];
                        for(var i = 0;i<datacount;i++) {
                            const d = {
                                x : '0909' + i,
                                start :  Math.random() * 5 + 15,
                                end:  Math.random() * 5 + 15
                            };
                            d.max = Math.max(d.start, d.end) + Math.random() * 5;
                            d.min = Math.min(d.start, d.end) - Math.random() * 5;
                            chart.data.push(d);
                        }
						chart.refresh();
						console.log(chart.data);
					}
					
					refresh();
				}
		</script>
	</head>
	<body>
		<div id="mycanvas">
			</div>	
        <hr />
        <div id="mylog">
			</div>	
	</body>
</html>
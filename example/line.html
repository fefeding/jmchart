<!doctype html>
<html>
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="content-type" />
<meta name="viewport" content="width=device-width,initial-scale=1">
		<!--<script type="text/javascript" src="../src/jmchart.debug.js" id="jmgraph" ></script>-->

		<style>
		html,body {
			margin:0;
			padding:0;
			width:100%;
			height:100%;
		}
		#mycanvas canvas, #mycanvas div{
			background-color:#fff;
			margin:0 auto;		
		}
		/*div.jm-tooltip {
			background-color: rgba(255,255,255,0.8);
			padding:4px;
			border:1px solid #000;
			box-shadow: 0 0 3px #000;
			border-radius: 6px;
		}*/
		</style>
		<script type="module">
			
			import { jmChart } from '../dist/bundle.cjs.js';

			(function load() {
				var w = Math.max((window.innerWidth || window.document.body.clientWidth) * 0.9, 600);
				var h = Math.max((window.innerHeight || window.document.body.clientHeight) * 0.6, 200);			
				inichart(w,h);
			})();
			

			function inichart(w, h) {
					var chart = new jmChart('mycanvas', {
						width: w,
						height: h,
						xField: 'x',
						// 最大和最小X值，  这里一般不用指定，除非硬是需要
						minXValue : 0,
						maxXValue : 10
					});
					chart.legend.legendPosition = 'top';
					chart.legend.visible = true;
					chart.enableAnimate = false;

					// touch改变数据点事件
					chart.on('touchPointChange', function(args) {
						console.log(args);
					});
					
					
					var line1 = chart.createSeries('bar', {
						field: 'y1',
						// 图例格式化，如果不给定，则采用legendLabel
						legendFormat: function(options) {
							return '图1';
						}
					});
					//line1.curve = true;//画曲线					

					var line2 = chart.createSeries('line', {
						field: 'y2',
						//index: 2, // 指定Y轴索引，如是档指定就会共用左边的Y轴，
						// 最大值和最小值，如果不指定会自动计算，
						// 如果指定了也只是指定了最大或最小边界，如果有数值超过它，依然以事实数值为准
						minYValue: 0,
						maxYValue: 500 ,
						legendFormat: function(options) {
							return '图例2';
						}
					});
					//line2.enableAnimate = true;

					//line2.enableAnimate = true;
					//chart.series.add(line2);	
					//line2.legendLabel = "测试图例2afasdf";


					var line3 = chart.createSeries('spline', {
						field: 'y3',
						legendLabel: '图例3'
					});						
		/*		
					var ymapping5 = {field:'y5',type:'y',dataType:'number'};
					var line5 = chart.createSeries('line',[xmapping,ymapping5]);
					chart.series.add(line5);		

					var ymapping6 = {field:'y6',type:'y',dataType:'number'};
					var line6 = chart.createSeries('line',[xmapping,ymapping6]);
					chart.series.add(line6);		

					var ymapping7 = {field:'y7',type:'y',dataType:'number'};
					var line7 = chart.createSeries('line',[xmapping,ymapping7]);
					chart.series.add(line7);	
					line7.enableAnimate = true;	
*/
					const datacount = 6;
					function animate() {
						if(true) {
							chart.data = [];
							for(var i = 0;i<datacount;i++) {
								var data = {
									x : i,
									y1 :  Math.random() * 200 - 100,
									y2: Math.random() * 200 + 50,
									y3: Math.random() * 200 + 50,
									y4:Math.random() * 200 + 50,
									y5:Math.random() * 200 + 50,
									y6:Math.random() * 200 + 50,
									y7:i,
									y8:Math.random() * 200 - 50,
									y9:Math.random() * 200 - 50,
									y10:Math.random() * 200 - 50
								};
								if(i == 3) {
									data.y = null;
								}
								chart.data.push(data);
							}
						}
						else {
							for(var i=datacount-1;i>0;i--) {
								var x = chart.data[i].x;
								chart.data[i] = chart.utils.clone(chart.data[i - 1]);
								chart.data[i].x = x;
							}
							
								chart.source[0] = {
									x : chart.data[0].x,
									y : Math.random() * 200 - 100
								};
								
						}
						
						//setTimeout(animate,500);
						chart.refresh();
						console.log(chart.data);

						chart2.data = chart.data;
						chart2.refresh();
					}


					
					var chart2 = new jmChart('mycanvas2',{
						width: w,
						height: Math.max(h, 500)
					});
					chart2.legendPosition = 'top';
					chart2.legend.visible = true;
					chart2.enableAnimate = false;
					
					var pie = chart2.createSeries('pie', {
						field: 'y6',
						legendFormat: function(options) {
							return 'test' + options.data.y8;
						}
					});

					
					animate();

					chart.utils.bindEvent(document.getElementById('btnRedraw'),'click',function() {
							chart.data = [];
							//datacount = Math.random() * 10 + 4;
							for(var i = 0;i<datacount;i++) {
								var data = {
									x : i,
									y1 : Math.random() * 200 + 100,
									y2:Math.random() * 200,
									y3:Math.random() * 200 + 50,
									y4:Math.random() * 200 + 50,
									y5:Math.random() * 200 + 50,
									y6:Math.random() * 200 - 50,
									y7:Math.random() * 200 + 50,
									y8:Math.random() * 200 - 50,
									y9:Math.random() * 200 - 50,
									y10:Math.random() * 200 - 50
								};
								chart.data.push(data);
							}
							chart.refresh();
							//chart2.refresh();
						});
					
				}
		</script>
	</head>
	<body>
		<div id="mycanvas">
			</div>	
		<div id="mycanvas2">
			</div>	
			<button id="btnRedraw">重绘</button>		
	</body>
</html>